(function(){cc.PhysicsSprite=cc.Sprite.extend({_ignoreBodyRotation:!1,_body:null,_rotation:1,ctor:function(a,c){cc.Sprite.prototype.ctor.call(this);if(void 0===a)cc.PhysicsSprite.prototype.init.call(this);else if("string"===typeof a)if("#"===a[0]){var b=a.substr(1,a.length-1),b=cc.spriteFrameCache.getSpriteFrame(b);this.initWithSpriteFrame(b)}else this.init(a,c);else"object"===typeof a&&(a instanceof cc.Texture2D?this.initWithTexture(a,c):a instanceof cc.SpriteFrame&&this.initWithSpriteFrame(a))},
setBody:function(a){this._body=a},getBody:function(){return this._body},getPosition:function(){var a=this._body;return{x:a.p.x,y:a.p.y}},getPositionX:function(){return this._body.p.x},getPositionY:function(){return this._body.p.y},setPosition:function(a,c){void 0===c?(this._body.p.x=a.x,this._body.p.y=a.y):(this._body.p.x=a,this._body.p.y=c)},setPositionX:function(a){this._body.p.x=a},setPositionY:function(a){this._body.p.y=a},_syncPosition:function(){var a=this._position,c=this._body;(a.x!=c.p.x||
a.y!=c.p.y)&&cc.Sprite.prototype.setPosition.call(this,c.p.x,c.p.y)},getRotation:function(){return this._ignoreBodyRotation?cc.radiansToDegrees(this._rotationRadiansX):-cc.radiansToDegrees(this._body.a)},setRotation:function(a){this._ignoreBodyRotation?cc.Sprite.prototype.setRotation.call(this,a):this._body.a=-cc.degreesToRadians(a)},_syncRotation:function(){this._rotationRadiansX!=-this._body.a&&cc.Sprite.prototype.setRotation.call(this,-cc.radiansToDegrees(this._body.a))},nodeToParentTransform:function(){return this.getNodeToParentTransform()},
getNodeToParentTransform:function(){if(cc._renderType===cc._RENDER_TYPE_CANVAS)return this._nodeToParentTransformForCanvas();var a=this._body,c=this._anchorPointInPoints,b=this._scaleX,e=this._scaleY,g=a.p.x,h=a.p.y;this._ignoreAnchorPointForPosition&&(g+=c.x,h+=c.y);var f=a.a,a=Math.cos(f),f=Math.sin(f);cc._rectEqualToZero(c)||(g+=a*-c.x*b+-f*-c.y*e,h+=f*-c.x*b+a*-c.y*e);return this._transform=cc.affineTransformMake(a*b,f*b,-f*e,a*e,g,h)},_nodeToParentTransformForCanvas:function(){if(this.dirty){var a=
this._transform,b=this._body,d=this._scaleX,e=this._scaleY,g=this._anchorPointInPoints;a.tx=b.p.x;a.ty=b.p.y;var b=-b.a,h=1,f=0;b&&(h=Math.cos(b),f=Math.sin(b));a.a=a.d=h;a.b=-f;a.c=f;if(1!==d||1!==e)a.a*=d,a.c*=d,a.b*=e,a.d*=e;a.tx+=h*-g.x*d+-f*g.y*e;a.ty-=f*-g.x*d+h*g.y*e;this._ignoreAnchorPointForPosition&&(a.tx+=g.x,a.ty+=g.y);this._transformDirty=!1}return this._transform},isDirty:function(){return!this._body.isSleeping()},setDirty:function(){},setIgnoreBodyRotation:function(a){this._ignoreBodyRotation=
a}});cc.PhysicsSprite._className="PhysicsSprite";var b=cc.PhysicsSprite.prototype;cc.defineGetterSetter(b,"body",b.getBody,b.setBody);cc.defineGetterSetter(b,"dirty",b.isDirty,b.setDirty);cc.PhysicsSprite.create=function(a,b){return new cc.PhysicsSprite(a,b)};cc.PhysicsSprite.createWithSpriteFrameName=cc.PhysicsSprite.create;cc.PhysicsSprite.createWithSpriteFrame=cc.PhysicsSprite.create})();cc.__convertVerts=function(b){for(var a=[],c=0;c<b.length/2;c++)a[c]={x:b[2*c],y:b[2*c+1]};return a};cc.ColorForBody=function(b){return b.isRogue()||b.isSleeping()?cc.color(128,128,128,128):b.nodeIdleTime>b.space.sleepTimeThreshold?cc.color(84,84,84,128):cc.color(255,0,0,128)};
cc.DrawShape=function(b,a){var c=b.body,d=cc.ColorForBody(c);switch(b.collisionCode){case cp.CircleShape.prototype.collisionCode:this.drawDot(b.tc,Math.max(b.r,1),d);this.drawSegment(b.tc,cp.v.add(b.tc,cp.v.mult(c.rot,b.r)),1,d);break;case cp.SegmentShape.prototype.collisionCode:this.drawSegment(b.ta,b.tb,Math.max(b.r,2),d);break;case cp.PolyShape.prototype.collisionCode:c=cc.color(d.r,d.g,d.b,cc.lerp(d.a,255,0.5));this.drawPoly(cc.__convertVerts(b.tVerts),d,1,c);break;default:cc.log("cc.DrawShape(): Bad assertion in DrawShape()")}};
cc.DrawConstraint=function(b,a){var c=b.a,d=b.b,e;b instanceof cp.PinJoint?(e=c.local2World(b.anchr1),c=d.local2World(b.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR)):b instanceof cp.SlideJoint?(e=c.local2World(b.anchr1),c=d.local2World(b.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR)):b instanceof cp.PivotJoint?(e=c.local2World(b.anchr1),
c=d.local2World(b.anchr2),this.drawDot(e,3,cc.CONSTRAINT_COLOR),this.drawDot(c,3,cc.CONSTRAINT_COLOR)):b instanceof cp.GrooveJoint&&(e=c.local2World(b.grv_a),c=c.local2World(b.grv_b),d=d.local2World(b.anchr2),this.drawDot(d,3,cc.CONSTRAINT_COLOR),this.drawSegment(e,c,1,cc.CONSTRAINT_COLOR))};cc.CONSTRAINT_COLOR=cc.color(0,255,0,128);
cc.PhysicsDebugNode=cc.DrawNode.extend({_space:null,_className:"PhysicsDebugNode",ctor:function(b){cc.DrawNode.prototype.ctor.call(this);this._space=b},getSpace:function(){return this._space},setSpace:function(b){this._space=b},draw:function(b){this._space&&(this._space.eachShape(cc.DrawShape.bind(this)),this._space.eachConstraint(cc.DrawConstraint.bind(this)),cc.DrawNode.prototype.draw.call(this),this.clear())}});cc.PhysicsDebugNode.create=function(b){return new cc.PhysicsDebugNode(b)};